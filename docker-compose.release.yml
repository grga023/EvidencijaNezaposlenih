services:
  app:
    container_name: evidencija_app
    image: ${DOCKER_REGISTRY}evidencijanezaposlenih_internetprogramiranje:${IMAGE_TAG}
    user: "0"  
    environment:
      ASPNETCORE_ENVIRONMENT: "${ASPNETCORE_ENV}"
      ASPNETCORE_Kestrel__Certificates__Default__Path: "/root/.aspnet/https/aspnetapp.pfx"
      ASPNETCORE_Kestrel__Certificates__Default__Password: "YourPassword"
      ASPNETCORE_URLS: "https://+:8081;http://+:8080"
      ApiSettings__BaseUrl: "${SERVER_URL_HTTPS}"
      ConnectionStrings__EvidencijaNezaposlenihDBContext: "${EVIDENCIJA_NEZAPOSLENIH_DB}"
      ConnectionStrings__IdentitetiDBContext: "${IDENTITETI_DB}"
    ports:
      - "${WEB_HTTP_PORT}:8080"
      - "${WEB_HTTPS_PORT}:8081"
    volumes:
      - ./certs:/root/.aspnet/https:ro
    depends_on:
      - db

  db:
    image: mcr.microsoft.com/azure-sql-edge:latest
    container_name: db
    ports:
      - "${DB_PORT}:1433"
    environment:
      SA_PASSWORD: "${DB_PASSWORD}"
      ACCEPT_EULA: "Y"
    mem_limit: 1g
    user: "0"


  adminer:
    image: adminer
    container_name: adminer
    restart: always
    ports:
      - "${ADMINER_PORT}:8080"
    depends_on:
      - db

  portainer:
    image: portainer/portainer-ce
    container_name: portainer
    command: -H unix:///var/run/docker.sock
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    ports:
      - "${PORTAINER_PORT}:9000"
    restart: always

volumes:
  db1data:
  portainer_data: